<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>RSA加密工具 - GET请求版</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsencrypt/3.3.2/jsencrypt.min.js"></script>
</head>
<body>
    <div id="result"></div>

    <script>
        // 从URL获取参数
        function getQueryParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // RSA加密函数
        function encryptContent(pbkey, content) {
            if (!pbkey || !content) return "";
            const encrypt = new JSEncrypt();
            encrypt.setPublicKey(pbkey);
            return encrypt.encrypt(content) || "";
        }

        // 处理特殊字符
        function encodeSpecialChars(content) {
            if (!content) return content;
            
            const charMap = {
                '+': '%2B',
                ' ': '%20',
                '/': '%2F',
                '?': '%3F',
                '&': '%26',
                '=': '%3D',
                '#': '%23'
            };
            
            return content.replace(/[+ /?&=#]/g, match => charMap[match]);
        }

        // 主执行逻辑
        function main() {
            const pbkey = getQueryParam('pbkey');
            const content = getQueryParam('content');
            const callbackUrl = "https://open.feishu.cn/anycross/trigger/callback/MGU0ZTIxODdlZTIyMGY3N2FiODdhMzhlNjc5MmNkNmEy";
            
            if (!pbkey || !content) {
                document.getElementById('result').textContent = '请提供pbkey和content参数';
                return;
            }
            
            try {
                // 加密内容
                const encrypted = encryptContent(pbkey, content);
                if (!encrypted) {
                    document.getElementById('result').textContent = '加密失败，请检查公钥格式';
                    return;
                }
                
                // 处理特殊字符
                const processed = encodeSpecialChars(encrypted);
                
                // 显示加密结果
                document.getElementById('result').textContent = '加密结果: ' + processed;
                
                // 如果有回调URL，则跳转
                if (callbackUrl) {
                    const resultUrl = `${callbackUrl}?encrypted=${encodeURIComponent(processed)}`;
                    window.location.href = resultUrl;
                }
                
            } catch (e) {
                document.getElementById('result').textContent = '加密过程中出错: ' + e.message;
            }
        }

        // 页面加载后执行
        window.onload = main;
    </script>
</body>
</html>
