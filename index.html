<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>RSA加密结果</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsencrypt/3.3.2/jsencrypt.min.js"></script>
</head>

<body>
    <div id="result"></div>

    <script>
        // 从URL获取参数
        function getQueryParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // RSA加密函数
        function encryptContent(pbkey, content) {
            if (!pbkey || !content) return "";
            const encrypt = new JSEncrypt();
            encrypt.setPublicKey(pbkey);
            return encrypt.encrypt(content) || "";
        }

        // 处理特殊字符
        function dealEncryptContent(content) {
            if (!content) return content;
            const specialCharMap = [
                { original: '+', encoded: '%2B' },
                { original: ' ', encoded: '%20' },
                { original: '/', encoded: '%2F' },
                { original: '?', encoded: '%3F' },
                { original: '&', encoded: '%26' },
                { original: '=', encoded: '%3D' },
                { original: '#', encoded: '%23' }
            ];

            let processed = content;
            specialCharMap.forEach(mapping => {
                processed = processed.replace(new RegExp('\\' + mapping.original, 'g'), mapping.encoded);
            });
            return processed;
        }

        // 主执行逻辑
        function main() {
            const pbkey = getQueryParam('pbkey');
            const content = getQueryParam('content');

            if (!pbkey || !content) {
                document.getElementById('result').textContent = '请提供pbkey和content参数';
                return;
            }

            try {
                const encrypted = encryptContent(pbkey, content);
                const processed = dealEncryptContent(encrypted);
                document.getElementById('result').textContent = processed;
            } catch (e) {
                document.getElementById('result').textContent = '加密失败: ' + e.message;
            }
        }

        // 页面加载后执行
        window.onload = main;
    </script>
</body>

</html>
